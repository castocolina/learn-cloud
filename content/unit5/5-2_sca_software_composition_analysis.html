<div class="container">
    <div class="page-header">
        <h1>5.2: SCA (Software Composition Analysis)</h1>
    </div>

    <p class="lead">Modern applications are rarely built from scratch. We rely on a vast ecosystem of open-source libraries and third-party dependencies to accelerate development. While this is powerful, it also introduces risk. <strong>Software Composition Analysis (SCA)</strong> is the automated process of identifying the open-source components in a codebase and scanning them for known security vulnerabilities.</p>
    <p>If SAST is about finding flaws in your own code, SCA is about finding flaws in the code you import. Managing this "software supply chain" is a critical part of DevSecOps.</p>

    <div class="text-center my-4">
        <pre class="mermaid">
            graph TD
                A["Your Application Code"] --> B["Dependency 1 (e.g., requests)"];
                A --> C["Dependency 2 (e.g., gin)"];
                B --> D["Transitive Dependency 1.1"];
                C --> E["Transitive Dependency 2.1"];
                C --> F["Transitive Dependency 2.2"];
                
                subgraph "SCA Scan"
                    B -- "Scans for CVEs" --> B;
                    C -- "Scans for CVEs" --> C;
                    D -- "Scans for CVEs" --> D;
                    E -- "Scans for CVEs" --> E;
                    F -- "Scans for CVEs" --> F;
                end

                style B fill:#f9f,stroke:#333,stroke-width:2px
                style C fill:#f9f,stroke:#333,stroke-width:2px
        </pre>
        <small class="text-muted">Diagram: SCA scans both direct and transitive dependencies for vulnerabilities.</small>
    </div>

    <hr/>

    <h2><i class="bi bi-file-earmark-code"></i> SCA for Python</h2>
    <p>
        For Python, several tools can scan your dependencies. We'll look at two popular ones: <code>pip-audit</code> and <code>safety</code>. They both check your installed packages against vulnerability databases.
    </p>

    <h4>Tooling: <code>pip-audit</code></h4>
    <p><code>pip-audit</code> is a tool developed by the Python Packaging Authority (PyPA) that audits your environment against the Python Packaging Advisory Database (PyPI Advisory Database).</p>
    <pre><code class="language-bash">
# Install the tool
pip install pip-audit

# Run it against your requirements file
pip-audit -r requirements.txt
    </code></pre>

    <h4>Example: Finding a Vulnerable Package</h4>
    <p>Let's say your <code>requirements.txt</code> contains an old, vulnerable version of a library:</p>
    <pre><code class="language-text">
# requirements.txt
requests==2.20.0
    </code></pre>
    <p>Running `pip-audit` would produce a report:</p>
    <pre><code class="language-bash">
$ pip-audit -r requirements.txt
...
Vulnerability found in requests version 2.20.0
  ID: PYSEC-2021-428
  Fix versions: 2.25.0
  Description: Requests includes a fix for CVE-2021-28362: an issue where `session.merge_environment_settings` does not merge `cert` values from the `request.cert` parameter.
...
    </code></pre>

    <h4>Integrating SCA into CI/CD</h4>
    <p>You can add an SCA check as a step in your GitHub Actions workflow.</p>
    <pre><code class="language-yaml">
# .github/workflows/ci.yml
jobs:
  sca-scan:
    name: Software Composition Analysis
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run pip-audit
        run: |
          pip install pip-audit
          pip-audit
    </code></pre>

    <hr/>

    <h2><i class="bi bi-file-earmark-code-fill"></i> SCA for Go: govulncheck</h2>
    <p>
        The official tool for finding known vulnerabilities in Go projects is <strong><code>govulncheck</code></strong>. It's integrated into the Go toolchain and provides a key advantage: it analyzes your codebase to see if your code actually calls the vulnerable functions in a dependency. This reduces noise by only reporting vulnerabilities in code paths that are reachable by your application.
    </p>

    <h4>Installation & Usage</h4>
    <p><code>govulncheck</code> is part of the standard Go distribution as of Go 1.21.</p>
    <pre><code class="language-bash">
# Run govulncheck on your entire module
govulncheck ./...
    </code></pre>

    <h4>Example Output</h4>
    <p>If a vulnerability is found, `govulncheck` provides detailed information:</p>
    <pre><code class="language-text">
Vulnerability #1: GO-2022-0123
  A vulnerability in the `example.com/vulnerable/module` library allows for...
  Found in: example.com/vulnerable/module@v1.2.3
  Fixed in:  example.com/vulnerable/module@v1.2.4
  Your code is affected:
    Your module calls vulnerable function `VulnerableFunction` at:
      /path/to/your/project/main.go:42:23
    </code></pre>

    <h4>Integrating `govulncheck` into CI/CD</h4>
    <p>You can add `govulncheck` as a step in your GitHub Actions workflow.</p>
    <pre><code class="language-yaml">
# .github/workflows/ci.yml
jobs:
  govulncheck:
    name: Go Vulnerability Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.22'
      - name: Run govulncheck
        run: go install golang.org/x/vuln/cmd/govulncheck@latest && govulncheck ./...
    </code></pre>

</div>
